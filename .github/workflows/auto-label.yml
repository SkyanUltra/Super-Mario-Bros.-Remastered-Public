name: Auto-Label Issues

on:
  issues:
    types: [opened]

permissions:
  issues: write  # Required to add labels

jobs:
  auto-label:
    runs-on: ubuntu-latest
    steps:
      - name: Parse issue type and apply label
        uses: actions/github-script@v7
        with:
          script: |
            const { issue } = github.event;
            const body = issue.body || '';
            
            // Define your type mappings (adjust keys to match your template's 'value' options)
            const typeToLabel = {
              'bug': 'type:bug',
              'feature': 'type:feature',
              'question': 'type:question',
              // Add more mappings as needed, e.g., 'documentation': 'type:docs'
            };
            
            // Regex to find the selected choice (assumes format: "**Selected choice**\nvalue")
            // Adjust regex if your template renders differently
            const typeMatch = body.match(/^\s*\*\*Selected choice\*\*\s*\n\s*(\w+)/im);
            if (typeMatch) {
              const selectedType = typeMatch[1].toLowerCase();
              const label = typeToLabel[selectedType];
              if (label) {
                // Check if label already exists
                const { data: existingLabels } = await github.rest.issues.listLabelsOnIssue({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number
                });
                const hasLabel = existingLabels.some(l => l.name === label);
                
                if (!hasLabel) {
                  await github.rest.issues.addLabels({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: issue.number,
                    labels: [label]
                  });
                  console.log(`Added label '${label}' to issue #${issue.number}`);
                } else {
                  console.log(`Label '${label}' already exists on issue #${issue.number}`);
                }
              } else {
                console.log(`Unknown type '${selectedType}' for issue #${issue.number}`);
              }
            } else {
              console.log('No type ID found in issue body #${issue.number}');
            }
